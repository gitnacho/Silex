
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Usándola &mdash; Manual de Silex en Español</title>
    
    <link rel="stylesheet" href="_static/tnp.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="shortcut icon" href="_static/icotnp.ico"/>
    <link rel="top" title="Manual de Silex en Español" href="index.html" />
    <link rel="next" title="Servicios" href="services.html" />
    <link rel="prev" title="Introducción" href="intro.html" /> 
  </head>
  <body>
  <div class="imalogo">
    
  <a href="index.html"><img src="http://gitnacho.github.com/tnp/img/silex/logo_silex.png" alt="La microplataforma PHP basada en los componentes de Symfony2" />
  
    <a href="http://gitnacho.github.com/tnp/"><img src="http://gitnacho.github.com/tnp/_static/normaltnp.png" alt="Traducciones de Nacho Pacheco" /></a>
    <div class="social">
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="esymfony" data-lang="es">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
    <div id="searchbox">
      <form class="searc " action="search.html" method="get">
      <input type="search" name="q" placeholder="Término a buscar" />
      <input type="submit" value="Ir" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
    

    
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="services.html" title="Servicios"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introducción"
             accesskey="P">anterior</a> |</li>
        <li><a href="index.html">Silex en Español</a> &raquo;</li> 
      </ul>
    </div>
  </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="usandola">
<h1>Usándola<a class="headerlink" href="#usandola" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Este capítulo describe cómo utilizar <em>Silex</em>.</p>
<div class="section" id="arranque">
<h2>Arranque<a class="headerlink" href="#arranque" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para incluir <em>Silex</em> todo lo que tienes que hacer es requerir el archivo <tt class="docutils literal"><span class="pre">silex.phar</span></tt> y crear una instancia de <tt class="docutils literal"><span class="pre">Silex\Application</span></tt>. Después de definir tu controlador, llama al método <tt class="docutils literal"><span class="pre">run</span></tt> en tu aplicación:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/silex.phar&#39;</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Silex\Application</span><span class="p">();</span>

<span class="c1">// definiciones</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</div>
<p>Otra cosa que tienes que hacer es configurar tu servidor web. Si estás usando <em>Apache</em> puedes utilizar un <tt class="docutils literal"><span class="pre">.htaccess</span></tt> para esto.</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nt">&lt;IfModule</span> <span class="s">mod_rewrite.c</span><span class="nt">&gt;</span>
    <span class="nb">Options</span> -MultiViews

    <span class="nb">RewriteEngine</span> <span class="k">On</span>
    <span class="c">#RewriteBase /ruta/a/tu/aplicación</span>
    <span class="nb">RewriteCond</span> %{REQUEST_FILENAME} !-f
    <span class="nb">RewriteRule</span> ^ index.php [L]
<span class="nt">&lt;/IfModule&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si tu sitio no está a nivel raíz del servidor web, tienes que descomentar la declaración <tt class="docutils literal"><span class="pre">RewriteBase</span></tt> y ajustar la ruta para que apunte al directorio, relativo a la raíz del servidor web.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p>Cuando desarrollas un sitio web, posiblemente desees activar el modo de depuración para facilitar la corrección de errores:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p>Si tu aplicación se encuentra detrás de un delegado inverso y deseas que <em>Silex</em> compruebe las cabeceras <tt class="docutils literal"><span class="pre">X-Forwarded-For*</span></tt>, tendrás que ejecutar tu aplicación así:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nx">Request</span><span class="o">::</span><span class="na">trustProxyData</span><span class="p">();</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="enrutado">
<h2>Enrutado<a class="headerlink" href="#enrutado" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En <em>Silex</em> defines una ruta y el controlador que se invocará cuando dicha ruta concuerde</p>
<p>Un patrón de ruta se compone de:</p>
<ul class="simple">
<li><em>Pattern</em>: El patrón de ruta define una ruta que apunta a un recurso.
El patrón puede incluir partes variables y tú podrás establecer los requisitos con expresiones regulares.</li>
<li><em>Method</em>: Uno de los siguientes métodos <em>HTTP</em>: <tt class="docutils literal"><span class="pre">GET</span></tt>, <tt class="docutils literal"><span class="pre">POST</span></tt>, <tt class="docutils literal"><span class="pre">PUT</span></tt>
<tt class="docutils literal"><span class="pre">DELETE</span></tt>. Este describe la interacción con el recurso. Normalmente sólo se utilizan <tt class="docutils literal"><span class="pre">GET</span></tt> y <tt class="docutils literal"><span class="pre">POST</span></tt>, pero, también es posible utilizar los otros.</li>
</ul>
<p>El controlador se define usando un cierre de esta manera:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// hace algo</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Los cierres son funciones anónimas que pueden importar el estado desde fuera de su definición. Esto es diferente de las variables globales, porque el estado exterior no tiene que ser global. Por ejemplo, podrías definir un cierre en una función e importar variables locales desde esa función.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Los cierres que no importan el ámbito se conocen como lambdas.
Debido a que en <em>PHP</em> todas las funciones anónimas son instancias de la clase <tt class="docutils literal"><span class="pre">Closure</span></tt>, no vamos a hacer una distinción aquí.</p>
</div>
<p>El valor de retorno del cierre se convierte en el contenido de la página.</p>
<p>También existe una forma alterna para definir controladores que utilizan un método de clase. La sintaxis para esto es <strong>NombreClase</strong>::<strong>nombreMétodo</strong>.
También son posibles los métodos estáticos.</p>
<div class="section" id="ejemplo-de-ruta-get">
<h3>Ejemplo de ruta <tt class="docutils literal"><span class="pre">GET</span></tt><a class="headerlink" href="#ejemplo-de-ruta-get" title="Enlazar permanentemente con este título">¶</a></h3>
<p>He aquí un ejemplo de una definición de ruta <tt class="docutils literal"><span class="pre">GET</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$blogPosts</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="mi">1</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;date&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;2011-03-29&#39;</span><span class="p">,</span>
        <span class="s1">&#39;author&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;igorw&#39;</span><span class="p">,</span>
        <span class="s1">&#39;title&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;Using Silex&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$blogPosts</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$blogPosts</span> <span class="k">as</span> <span class="nv">$post</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$output</span> <span class="o">.=</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">];</span>
        <span class="nv">$output</span> <span class="o">.=</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$output</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Al visitar <tt class="docutils literal"><span class="pre">/blog</span></tt> devolverá una lista con los títulos de los comunicados en el <tt class="docutils literal"><span class="pre">blog</span></tt>. La declaración <tt class="docutils literal"><span class="pre">use</span></tt> significa algo diferente en este contexto. Esta instruye al cierre a importar la variable <tt class="docutils literal"><span class="pre">comunicadosBLog</span></tt> desde el ámbito externo. Esto te permite utilizarla dentro del cierre.</p>
</div>
<div class="section" id="enrutado-dinamico">
<h3>Enrutado dinámico<a class="headerlink" href="#enrutado-dinamico" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Ahora, puedes crear otro controlador para ver comunicados individuales del <tt class="docutils literal"><span class="pre">blog</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/show/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Silex\Application</span> <span class="nv">$app</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$blogPosts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$blogPosts</span><span class="p">[</span><span class="nv">$id</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;Post </span><span class="si">$id</span><span class="s2"> does not exist.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$post</span> <span class="o">=</span> <span class="nv">$blogPosts</span><span class="p">[</span><span class="nv">$id</span><span class="p">];</span>

    <span class="k">return</span>  <span class="s2">&quot;&lt;h1&gt;</span><span class="si">{</span><span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/h1&gt;&quot;</span><span class="o">.</span>
            <span class="s2">&quot;&lt;p&gt;</span><span class="si">{</span><span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Esta definición de ruta tiene una parte variable <tt class="docutils literal"><span class="pre">{id}</span></tt> que se pasa al cierre.</p>
<p>Cuando el comunicado no existe, estamos usando <tt class="docutils literal"><span class="pre">abort()</span></tt> para detener la petición inicial. En realidad, se produce una excepción, la cual veremos cómo manejar más adelante.</p>
</div>
<div class="section" id="ejemplo-de-ruta-post">
<h3>Ejemplo de ruta <tt class="docutils literal"><span class="pre">POST</span></tt><a class="headerlink" href="#ejemplo-de-ruta-post" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las rutas <tt class="docutils literal"><span class="pre">POST</span></tt> denotan la creación de un recurso. Un ejemplo de esto es un formulario de comentarios. Vamos a utilizar la función <tt class="docutils literal"><span class="pre">mail</span></tt> para enviar un correo electrónico:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/feedback&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">);</span>
    <span class="nb">mail</span><span class="p">(</span><span class="s1">&#39;feedback@yoursite.com&#39;</span><span class="p">,</span> <span class="s1">&#39;[YourSite] Feedback&#39;</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Thank you for your feedback!&#39;</span><span class="p">,</span> <span class="mi">201</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Es bastante sencillo.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Hay un <a class="reference internal" href="providers/swiftmailer.html"><em>SwiftmailerServiceProvider</em></a> incluido que puedes utilizar en lugar de <tt class="docutils literal"><span class="pre">mail()</span></tt>.</p>
</div>
<p>La <tt class="docutils literal"><span class="pre">petición</span></tt> actual es inyectada al <tt class="docutils literal"><span class="pre">cierre</span></tt> automáticamente por <em>Silex</em> gracias al indicador de tipo. Es una instancia de <a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html">Request</a>, por tanto puedes recuperar las variables usando el método <tt class="docutils literal"><span class="pre">get</span></tt> de la petición.</p>
<p>En lugar de devolver una cadena regresamos una instancia de <a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html">Response</a>.
Esto nos permite fijar un código de estado <em>HTTP</em>, en este caso configurado a <tt class="docutils literal"><span class="pre">201</span> <span class="pre">Creado</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last"><em>Silex</em> siempre utiliza internamente una <tt class="docutils literal"><span class="pre">Respuesta</span></tt>, la convierte a cadenas para respuestas con código de estado <tt class="docutils literal"><span class="pre">200</span> <span class="pre">OK</span></tt>.</p>
</div>
</div>
<div class="section" id="otros-metodos">
<h3>Otros métodos<a class="headerlink" href="#otros-metodos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Puedes crear controladores para la mayoría de los métodos <em>HTTP</em>. Sólo tienes que llamar uno de estos métodos en tu aplicación: <tt class="docutils literal"><span class="pre">get</span></tt>, <tt class="docutils literal"><span class="pre">post</span></tt>, <tt class="docutils literal"><span class="pre">put</span></tt>, <tt class="docutils literal"><span class="pre">delete</span></tt>. También puedes llamar <tt class="docutils literal"><span class="pre">match</span></tt>, el cual coincidirá con todos los métodos:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Entonces puedes restringir los métodos permitidos a través del método <tt class="docutils literal"><span class="pre">method</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;PATCH&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Puedes sincronizar varios métodos con un controlador utilizando la sintaxis de expresiones regulares:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;PUT|POST&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">El orden en que definas las rutas es importante. La primera ruta que coincida se utilizará, por lo tanto coloca tus rutas más genéricas en la parte inferior.</p>
</div>
</div>
<div class="section" id="variables-de-ruta">
<h3>Variables de ruta<a class="headerlink" href="#variables-de-ruta" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Como mostramos antes, puedes definir partes variables en una ruta, como esta:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/show/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>
</pre></div>
</div>
<p>También es posible tener más de una parte variable, basta con que encierres los argumentos coincidentes con los nombres de las partes variables:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/show/{postId}/{commentId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$postId</span><span class="p">,</span> <span class="nv">$commentId</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Si bien no se sugiere, también lo puedes hacer (ten en cuenta la conmutación de los argumentos):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/show/{postId}/{commentId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$commentId</span><span class="p">,</span> <span class="nv">$postId</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>
</pre></div>
</div>
<p>También puedes consultar la <tt class="docutils literal"><span class="pre">Petición</span></tt> actual y el objeto <tt class="docutils literal"><span class="pre">Aplicación</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/show/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Application</span> <span class="nv">$app</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Ten en cuenta que para los objetos <tt class="docutils literal"><span class="pre">Aplicación</span></tt> y  <tt class="docutils literal"><span class="pre">Petición</span></tt>, <em>Silex</em> hace la inyección basándose en el indicador de tipo y no en el nombre de la variable:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/show/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Application</span> <span class="nv">$foo</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$bar</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="convertidores-de-variables-de-ruta">
<h3>Convertidores de variables de ruta<a class="headerlink" href="#convertidores-de-variables-de-ruta" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Antes de inyectar las variables de ruta en el controlador, puedes aplicar algunos convertidores:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$id</span><span class="p">;</span> <span class="p">});</span>
</pre></div>
</div>
<p>Esto es útil cuando quieres convertir las variables de ruta a objetos, ya que permite reutilizar el código de conversión entre diferentes controladores:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$userProvider</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{user}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nv">$userProvider</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{user}/edit&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nv">$userProvider</span><span class="p">);</span>
</pre></div>
</div>
<p>La retrollamada al convertidor también recibe la <tt class="docutils literal"><span class="pre">Petición</span></tt> como segundo argumento:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$callback</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$post</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;slug&#39;</span><span class="p">));</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}/{slug}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="nv">$callback</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="requisitos">
<h3>Requisitos<a class="headerlink" href="#requisitos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En algunos casos es posible que sólo desees detectar ciertas expresiones. Puedes definir los requisitos usando expresiones regulares llamando a <tt class="docutils literal"><span class="pre">assert</span></tt> en el objeto <tt class="docutils literal"><span class="pre">Controller</span></tt>, que es devuelto por los métodos de enrutado.</p>
<p>Lo siguiente se asegurará de que el argumento <tt class="docutils literal"><span class="pre">id</span></tt> es numérico, ya que <tt class="docutils literal"><span class="pre">\d+</span></tt> coincide con cualquier cantidad de dígitos:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/show/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>También puedes encadenar estas llamadas:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/show/{postId}/{commentId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$postId</span><span class="p">,</span> <span class="nv">$commentId</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;postId&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">)</span>
<span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;commentId&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="valores-predeterminados">
<h3>valores predeterminados<a class="headerlink" href="#valores-predeterminados" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Puedes definir un valor predeterminado para cualquier variable de ruta llamando a <tt class="docutils literal"><span class="pre">value</span></tt> en el objeto <tt class="docutils literal"><span class="pre">Controlador</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/{pageName}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$pageName</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">value</span><span class="p">(</span><span class="s1">&#39;pageName&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Esto te permitirá coincidir <tt class="docutils literal"><span class="pre">/</span></tt>, en cuyo caso la variable <tt class="docutils literal"><span class="pre">nombrePagina</span></tt> tendrá el valor de <tt class="docutils literal"><span class="pre">index</span></tt>.</p>
</div>
<div class="section" id="rutas-con-nombre">
<h3>Rutas con nombre<a class="headerlink" href="#rutas-con-nombre" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Algunos proveedores (como <tt class="docutils literal"><span class="pre">UrlGeneratorProvider</span></tt>) pueden usar rutas con nombre.
De manera predeterminada <em>Silex</em> generará un nombre de ruta para ti, el cual, en realidad, no puedes utilizar. Puedes dar un nombre a una ruta llamando a <tt class="docutils literal"><span class="pre">bind</span></tt> en el objeto <tt class="docutils literal"><span class="pre">Controlador</span></tt> devuelto por los métodos de enrutado:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;homepage&#39;</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/show/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;blog_post&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Sólo tiene sentido nombrar rutas si utilizas proveedores que usan la <tt class="docutils literal"><span class="pre">RouteCollection</span></tt>.</p>
</div>
</div>
</div>
<div class="section" id="filtros-before-y-after">
<h2>Filtros <tt class="docutils literal"><span class="pre">before</span></tt> y <tt class="docutils literal"><span class="pre">after</span></tt><a class="headerlink" href="#filtros-before-y-after" title="Enlazar permanentemente con este título">¶</a></h2>
<p><em>Silex</em> te permite ejecutar código antes y después de cada petición. Esto ocurre a través de los filtros <tt class="docutils literal"><span class="pre">before</span></tt> y <tt class="docutils literal"><span class="pre">after</span></tt>. Todo lo que necesitas hacer es pasar un cierre:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">before</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// configuración</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">after</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// destrucción</span>
<span class="p">});</span>
</pre></div>
</div>
<p>El filtro <tt class="docutils literal"><span class="pre">before</span></tt> tiene acceso a la <tt class="docutils literal"><span class="pre">Petición</span></tt> actual, y puede provocar un cortocircuito en toda la reproducción, devolviendo una <tt class="docutils literal"><span class="pre">Respuesta</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">before</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// redirige al usuario al formulario de acceso si el recurso accedido está protegido</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">RedirectResponse</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>El filtro <tt class="docutils literal"><span class="pre">after</span></tt> tiene acceso a la <tt class="docutils literal"><span class="pre">Petición</span></tt> y a la <tt class="docutils literal"><span class="pre">Respuesta</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">after</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Response</span> <span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ajusta la Respuesta</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Los filtros sólo los ejecuta la <tt class="docutils literal"><span class="pre">Petición</span></tt> &#8220;maestra&#8221;.</p>
</div>
</div>
<div class="section" id="servicios-intermedios-de-logica-para-la-ruta">
<h2>Servicios intermedios de lógica para la ruta<a class="headerlink" href="#servicios-intermedios-de-logica-para-la-ruta" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los servicios intermedios de lógica (<tt class="docutils literal"><span class="pre">middlewares</span></tt>) para la ruta son ejecutables <em>PHP</em> que se desencadenan cuando encaja su ruta asociada. Se disparan justo antes de la retrollamada a la ruta, pero después de aplicar los filtros <tt class="docutils literal"><span class="pre">before</span></tt>.</p>
<p>Los puedes usar en una gran cantidad de situaciones; Por ejemplo, aquí está una simple comprobación de &#8220;usuario anónimo/registrado&#8221;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$mustBeAnonymous</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;userId&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="s1">&#39;/user/logout&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nv">$mustBeLogged</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;userId&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="s1">&#39;/user/login&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/subscribe&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="nv">$mustBeAnonymous</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/login&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="nv">$mustBeAnonymous</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/my-profile&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="nv">$mustBeLogged</span><span class="p">);</span>
</pre></div>
</div>
<p>Una determinada ruta puede invocar varias veces a la función <tt class="docutils literal"><span class="pre">middleware</span></tt>, en cuyo caso se activa en el mismo orden en que la añadas a la ruta.</p>
<p>Por conveniencia, las funciones de lógica intermedia de ruta se activan con la instancia de la <tt class="docutils literal"><span class="pre">Petición</span></tt> actual como su único argumento.</p>
<p>Si alguno de los servicios de lógica intermedia de ruta devuelve una respuesta <em>HTTP</em> de <em>Symfony</em>, cortocircuita la reproducción completa: Los siguientes servicios de lógica intermedia no se ejecutarán, ni la retrollamada a la ruta. También puedes redirigir a otra página devolviendo una respuesta de redirección, la cual puedes crear llamando al método <tt class="docutils literal"><span class="pre">redirect</span></tt> de la aplicación.</p>
<p>Si un servicio de lógica intermedia de ruta no devuelve una respuesta <em>HTTP</em> de <em>Symfony</em> o <tt class="docutils literal"><span class="pre">null</span></tt>, se lanza una <tt class="docutils literal"><span class="pre">RuntimeException</span></tt>.</p>
</div>
<div class="section" id="manipuladores-de-error">
<h2>Manipuladores de error<a class="headerlink" href="#manipuladores-de-error" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Si alguna parte de tu código produce una excepción de la que desees mostrar algún tipo de página de error al usuario. Esto es lo que hacen los manipuladores de error. También puedes utilizarlos para hacer cosas adicionales, tal como registrar sucesos.</p>
<p>Para registrar un manipulador de error, pasa un cierre al método <tt class="docutils literal"><span class="pre">error</span></tt> el cual toma un argumento <tt class="docutils literal"><span class="pre">Exception</span></tt> y devuelve una respuesta:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;We are sorry, but something went terribly wrong.&#39;</span><span class="p">,</span> <span class="nv">$code</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>También puedes comprobar si hay errores específicos usando el argumento <tt class="docutils literal"><span class="pre">$code</span></tt>, y manejándolo de manera diferente:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">404</span><span class="o">:</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;The requested page could not be found.&#39;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;We are sorry, but something went terribly wrong.&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$code</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Si deseas configurar el registro puedes utilizar un manipulador de errores independiente para eso.
Sólo asegúrate de registrarlo antes que los manipuladores que responden a error, porque una vez que se devuelve una respuesta, se omiten los siguientes manipuladores.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last"><em>Silex</em> viene con un proveedor para <a class="reference external" href="https://github.com/Seldaek/monolog">Monolog</a> el cual maneja el registro de errores. Échale un vistazo al capítulo <a class="reference internal" href="providers.html"><em>Proveedores</em></a> para más detalles.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p><em>Silex</em> viene con un controlador de errores predeterminado que muestra un mensaje de error detallado con el seguimiento de la pila cuando <strong>debug</strong> es <tt class="docutils literal"><span class="pre">true</span></tt>, y de otra manera un mensaje de error simple. Los manipuladores de error registrados a través del método <tt class="docutils literal"><span class="pre">error()</span></tt> siempre tienen prioridad, pero puedes mantener agradables los mensajes de error de depuración cuando se enciende con algo como esto:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// lógica para manejar el error y devolver una respuesta</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<p>A los manipuladores de error también se les llama cuando utilizas <tt class="docutils literal"><span class="pre">abort</span></tt> para anular tempranamente una petición:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/show/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Silex\Application</span> <span class="nv">$app</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$blogPosts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$blogPosts</span><span class="p">[</span><span class="nv">$id</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;Post </span><span class="si">$id</span><span class="s2"> does not exist.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="redirigiendo">
<h2>Redirigiendo<a class="headerlink" href="#redirigiendo" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Puedes redirigir a otra página devolviendo una respuesta de redirección, la cual puedes crear mediante una llamada al método <tt class="docutils literal"><span class="pre">redirect</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Esto redirigirá de <tt class="docutils literal"><span class="pre">/</span></tt> a <tt class="docutils literal"><span class="pre">/hello</span></tt>.</p>
</div>
<div class="section" id="json">
<h2><em>JSON</em><a class="headerlink" href="#json" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Si quieres devolver datos <em>JSON</em>, puedes usar el método ayudante <tt class="docutils literal"><span class="pre">json</span></tt>.
Simplemente le tienes que proporcionar tus datos, código de estado y cabeceras, y este creará una respuesta <em>JSON</em> para ti.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/users/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$user</span> <span class="o">=</span> <span class="nx">getUser</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The user was not found.&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$error</span><span class="p">,</span> <span class="mi">404</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="transmitiendo-secuencias">
<h2>Transmitiendo secuencias<a class="headerlink" href="#transmitiendo-secuencias" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Es posible crear una respuesta para la transmisión de secuencias, lo cual es importante en los casos
cuando no puedes mantener en memoria los datos que se envían.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/images/{file}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/images/&#39;</span><span class="o">.</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s1">&#39;The image was not found.&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$stream</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">readfile</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">stream</span><span class="p">(</span><span class="nv">$stream</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;image/png&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Si necesitas enviar trozos, asegúrate de llamar a <tt class="docutils literal"><span class="pre">ob_flush</span></tt> y <tt class="docutils literal"><span class="pre">flush</span></tt> después de cada parte.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$stream</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nv">$fh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;http://www.example.com/&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$fh</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">echo</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$fh</span><span class="p">,</span> <span class="mi">1024</span><span class="p">);</span>
      <span class="nb">ob_flush</span><span class="p">();</span>
      <span class="nb">flush</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fh</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="seguridad">
<h2>Seguridad<a class="headerlink" href="#seguridad" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Asegúrate de proteger tu aplicación contra ataques.</p>
<div class="section" id="escapando">
<h3>Escapando<a class="headerlink" href="#escapando" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando reproduces la entrada del usuario (ya sea en las variables <tt class="docutils literal"><span class="pre">GET/POST</span></tt> o en variables obtenidas desde la petición), tendrás que asegurarte de escaparlas correctamente, para evitar ataques que exploten vulnerabilidades del sistema.</p>
<ul>
<li><p class="first"><strong>Escapando HTML</strong>: <em>PHP</em> proporciona la función <tt class="docutils literal"><span class="pre">htmlspecialchars</span></tt> para esto.
<em>Silex</em> ofrece un atajo, el método <tt class="docutils literal"><span class="pre">escape</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/name&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Silex\Application</span> <span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">&quot;You provided the name </span><span class="si">{</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">escape</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Si utilizas el motor de plantillas <em>Twig</em> debes usar su escape o, incluso, mecanismos de autoescape.</p>
</li>
<li><p class="first"><strong>Escapando JSON</strong>: Si quieres proporcionar datos en formato <em>JSON</em> debes utilizar la función <tt class="docutils literal"><span class="pre">json</span></tt> de <em>Silex</em>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/name.json&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Silex\Application</span> <span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="consola">
<h2>Consola<a class="headerlink" href="#consola" title="Enlazar permanentemente con este título">¶</a></h2>
<p><em>Silex</em> incluye una consola ligera para actualizar a la última versión.</p>
<p>Para saber qué versión de <em>Silex</em> estás utilizando, invoca a <tt class="docutils literal"><span class="pre">silex.phar</span></tt> en la línea de ordenes con <tt class="docutils literal"><span class="pre">version</span></tt> como argumento:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php silex.phar version
Silex version 0a243d3 2011-04-17 14:49:31 +0200
</pre></div>
</div>
<p>Para comprobar si estás utilizando la última versión, ejecuta la orden <tt class="docutils literal"><span class="pre">check</span></tt>:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php silex.phar check
</pre></div>
</div>
<p>Para actualizar <tt class="docutils literal"><span class="pre">silex.phar</span></tt> a la última versión, invoca la orden <tt class="docutils literal"><span class="pre">update</span></tt>:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php silex.phar update
</pre></div>
</div>
<p>Esto descargará automáticamente un nuevo <tt class="docutils literal"><span class="pre">silex.phar</span></tt> desde <tt class="docutils literal"><span class="pre">silex.sensiolabs.org</span></tt> y sustituirá al actual.</p>
</div>
<div class="section" id="trampas">
<h2>Trampas<a class="headerlink" href="#trampas" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Hay algunas cosas que pueden salir mal. Aquí vamos a tratar de esbozar las más frecuentes.</p>
<div class="section" id="configuracion-de-php">
<h3>Configuración de <em>PHP</em><a class="headerlink" href="#configuracion-de-php" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Ciertas distribuciones de <em>PHP</em>, de manera predeterminada tienen configurado <tt class="docutils literal"><span class="pre">Phar</span></tt> muy restrictivamente. Ajustar lo siguiente puede ayudar.</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="na">detect_unicode</span> <span class="o">=</span> <span class="s">Off</span>
<span class="na">phar.readonly</span> <span class="o">=</span> <span class="s">Off</span>
<span class="na">phar.require_hash</span> <span class="o">=</span> <span class="s">Off</span>
</pre></div>
</div>
<p>Si estás en <tt class="docutils literal"><span class="pre">Suhosin</span></tt> también tendrás que fijar lo siguiente:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="na">suhosin.executor.include.whitelist</span> <span class="o">=</span> <span class="s">phar</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">El <em>PHP</em> de <em>Ubuntu</em> viene con <em>Suhosin</em>, así que si estás usando <em>Ubuntu</em>, necesitarás este cambio.</p>
</div>
</div>
<div class="section" id="fallo-phar-stub">
<h3>Fallo <tt class="docutils literal"><span class="pre">Phar-Stub</span></tt><a class="headerlink" href="#fallo-phar-stub" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Algunas instalaciones de <em>PHP</em> tienen un error que arroja una <tt class="docutils literal"><span class="pre">PharException</span></tt> cuando tratas de incluir el <tt class="docutils literal"><span class="pre">Phar</span></tt>. También te dirá que <tt class="docutils literal"><span class="pre">Silex\Application</span></tt> no se pudo encontrar. Una solución es usar la siguiente línea:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">require_once</span> <span class="s1">&#39;phar://&#39;</span><span class="o">.</span><span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/silex.phar/autoload.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>La causa exacta de esta emisión no se ha podido determinar todavía.</p>
</div>
<div class="section" id="fallo-en-el-cargador-de-ioncube">
<h3>Fallo en el cargador de <tt class="docutils literal"><span class="pre">ioncube</span></tt><a class="headerlink" href="#fallo-en-el-cargador-de-ioncube" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El cargador de <tt class="docutils literal"><span class="pre">Ioncube</span></tt> es una extensión que puede decodificar archivos <em>PHP</em> codificados.
Desafortunadamente, las versiones antiguas (anteriores a la versión 4.0.9) no están funcionando bien con archivos <tt class="docutils literal"><span class="pre">phar</span></tt>.
Debes actualizar tu <tt class="docutils literal"><span class="pre">Ioncube</span> <span class="pre">Loder</span></tt> a la versión  4.0.9  o más reciente o desactivarla comentando o eliminando esta línea en tu archivo <tt class="docutils literal"><span class="pre">php.ini</span></tt>:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="na">zend_extension</span> <span class="o">=</span> <span class="s">/usr/lib/php5/20090626+lfs/ioncube_loader_lin_5.3.so</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuracion-iis">
<h2>Configuración <em>IIS</em><a class="headerlink" href="#configuracion-iis" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Si estás utilizando el <tt class="docutils literal"><span class="pre">Internet</span> <span class="pre">Information</span> <span class="pre">Services</span></tt> de <em>Windows</em>, puedes utilizar de ejemplo este archivo <tt class="docutils literal"><span class="pre">web.config</span></tt>:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;system.webServer&gt;</span>
        <span class="nt">&lt;defaultDocument&gt;</span>
            <span class="nt">&lt;files&gt;</span>
                <span class="nt">&lt;clear</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;add</span> <span class="na">value=</span><span class="s">&quot;index.php&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/files&gt;</span>
        <span class="nt">&lt;/defaultDocument&gt;</span>
        <span class="nt">&lt;rewrite&gt;</span>
            <span class="nt">&lt;rules&gt;</span>
                <span class="nt">&lt;rule</span> <span class="na">name=</span><span class="s">&quot;Silex Front Controller&quot;</span> <span class="na">stopProcessing=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;match</span> <span class="na">url=</span><span class="s">&quot;^(.*)$&quot;</span> <span class="na">ignoreCase=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;conditions</span> <span class="na">logicalGrouping=</span><span class="s">&quot;MatchAll&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;add</span> <span class="na">input=</span><span class="s">&quot;{REQUEST_FILENAME}&quot;</span> <span class="na">matchType=</span><span class="s">&quot;IsFile&quot;</span> <span class="na">ignoreCase=</span><span class="s">&quot;false&quot;</span> <span class="na">negate=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;/conditions&gt;</span>
                    <span class="nt">&lt;action</span> <span class="na">type=</span><span class="s">&quot;Rewrite&quot;</span> <span class="na">url=</span><span class="s">&quot;index.php&quot;</span> <span class="na">appendQueryString=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;/rule&gt;</span>
            <span class="nt">&lt;/rules&gt;</span>
        <span class="nt">&lt;/rewrite&gt;</span>
    <span class="nt">&lt;/system.webServer&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <a href="https://github.com/fabpot/Silex"><img style="position: fixed; top: 0; right: 0; border: 0;" src="http://gitnacho.github.com/tnp/img/comun/bifurcame.png" alt="Bifúrcame en GitHub" /></a>
  
  <div style="width:740px;margin:10px auto;">
    
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="services.html" title="Servicios"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introducción"
             >anterior</a> |</li>
        <li><a href="index.html">Silex en Español</a> &raquo;</li> 
      </ul>
    </div>
  </div>


   <div style="width: 740px; margin: 0 auto;">
     <div id="disqus_thread"></div>
     
    <div class="footer">
        &copy; Copyright 2010-11 Fabien Potencier :: Traducido por Nacho Pacheco.
      Creado con <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
   </div>
   <script type="text/javascript">
    var disqus_shortname = 'documentos-mx';
    
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
   </script>
   <noscript>
     Por favor activa JavaScript para ver los <a href="http://disqus.com/?ref_noscript">comentarios accionados por Disqus.</a>
   </noscript>

  </body>
</html>